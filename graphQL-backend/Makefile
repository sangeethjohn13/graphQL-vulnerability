dockerfile_attack="attack.Dockerfile"
dockerfile_mitigate="mitigate.Dockerfile"

# create a local network for containers to communicate
create_network:
	docker network create --driver=bridge vulnerablenetwork

# run the mondodb container
run_mongo:
	docker run --name mongodb --network vulnerablenetwork -p 27017:27017 -d mongo:4.4

# build the backend container
build_attacker:
	docker build -t graphqlvulnerablenode:latest -f ${dockerfile_attack} . 

# run the backend
run_attacker:
	docker run -d -p 3001:3001 --network vulnerablenetwork graphqlvulnerablenode:latest

# build the backend container
build_mitigate:
	docker build -t graphqlnode:latest -f ${dockerfile_mitigate} . 

# run the backend
run_mitigate:
	docker run -d -p 3000:3000 --network vulnerablenetwork graphqlnode:latest

# batch container build
build_attacker_mitigate:
	${MAKE} build_attacker
	${MAKE} build_mitigate

# batch container run
run_attacker_mitigate:
	${MAKE} run_mitigate
	${MAKE} run_attacker